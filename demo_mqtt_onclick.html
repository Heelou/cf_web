<!DOCTYPE html>
<html>
<head>
  <title>HTML TEST</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>

</head>
<body>
<h1>MQTT Publisher</h1>
<input type="number" id="phone_num" placeholder="Enter the phone numer">
<input type="text" id="user_message" placeholder="Enter a message to publish">
<button id = "first_click" onclick="publish()">Publish</button>
<!-- <button onclick="getElementById('demo1').innerHTML=Date()">What is the time?</button>
<p id="demo1"></p> -->

<!-- Print all message published -->

<h1>Published Message</h1>
<div id="all_message"></div>
<h1>History</h1>
<div style="height:120px;width:120px;border:1px solid #ccc;font:16px/26px Georgia, Garamond, Serif;overflow:auto;">
<p id="m1"></p>
<p id="m2"></p>
<p id="m3"></p>
</div>
<button onclick="hide_show()">Hide/Show</button>
<div id="myDIV">
<h1>Published Message</h1>
<p id="m1"></p>
<p id="m2"></p>
<p id="m3"></p>
<p id="m4"></p>
<p id="m5"></p>
</div>
<script>
var time = 1
function hide_show() {
  var x = document.getElementById("myDIV");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
function publish() { 
  // Create a new MQTT client
  const number = Math.floor(Math.random() * 100);
  const clientID = "client"+number;
  const client = new Paho.MQTT.Client("171.244.57.88", 8083, clientID);
  // set callback handlers
  client.onConnectionLost = function (responseObject) {
   console.log("Connection Lost: "+responseObject.errorMessage);
  }

  client.onMessageArrived = function (message) {
   console.log("Message Arrived: "+message.payloadString);
  }
  // Called when the connection is made
  // Connect the client, providing an onConnect callback
  client.connect({
    onSuccess: onConnect
   });
  function onConnect(){
    console.log("Connected!");
    // document.getElementById("first_click").innerHTML = "Connected!";
    var m_topic = "Message: "+ document.getElementById("user_message").value+ ", Topic: cfprj/"+ document.getElementById("phone_num").value+"/test";
    console.log(m_topic);
    var message = new Paho.MQTT.Message(document.getElementById("user_message").value);
    var topic = "cfprj/" + document.getElementById("phone_num").value + "/test";
    message.destinationName = topic;
    message.qos = 0;
    client.send(message);

    // var but_time = "m"+time;
    // document.getElementById(but_time).innerHTML = m_topic;
    // time = time +1;
    // if (time > 5)
    //   time = 1;

    document.getElementById("all_message").innerHTML += "<br>" + m_topic;

  }
}
</script>
</body>
</html>